var list=[],timeout=null,playlist,autocomplete=!1,container=document.getElementById("autocomplete"),input=container.getElementsByTagName("input")[0],resultDiv=document.getElementById("autocomplete-result"),loadingIndicator=container.getElementsByClassName("flash")[0],resetSelection=function(){var e=resultDiv.getElementsByClassName("selected");[].forEach.call(e,function(e){e.classList.toggle("selected")})},resultDivMeasures=function(){resultDiv.style.marginTop=container.offsetHeight+"px",resultDiv.style.width=container.offsetWidth+"px"};resultDiv.onmouseover=resetSelection,window.addEventListener("load",resultDivMeasures,!1),window.addEventListener("resize",resultDivMeasures,!1);var checkRegex=function(){const e=/(?:https?:\/\/)*(?:[a-z].*).?youtube.com\/.*list=([a-zA-Z0-9-_]*)(?:.*index=(\d*))?/;var t=e.exec(input.value);return!!t&&(playlist=t[1],!0)};input.onblur=function(){setTimeout(function(){resultDiv.style.visibility="hidden"},200)},input.onfocus=function(){resultDiv.style.visibility="visible"},document.addEventListener("keydown",function(e){switch(e.key){case"e":if(document.activeElement!=input){e.preventDefault(),input.focus();break}}}),input.onkeydown=function(e){var t=resultDiv.getElementsByClassName("selected")[0];switch(e.key){case"Escape":input.blur(),resultDiv.style.visibility="hidden";break;case"End":null!=t&&t.classList.toggle("selected"),resultDiv.lastElementChild.classList.add("selected");break;case"Home":null!=t&&t.classList.toggle("selected"),resultDiv.firstElementChild.classList.add("selected");break;case"ArrowDown":if(null==t){var i=resultDiv.firstElementChild;i.classList.toggle("selected"),autocomplete=i.classList[0]}null!=t&&(t.classList.toggle("selected"),null!=t.nextElementSibling&&(t.nextElementSibling.classList.toggle("selected"),autocomplete=resultDiv.getElementsByClassName("selected")[0].classList[0]));break;case"ArrowUp":if(null==t){var s=resultDiv.lastElementChild;s.classList.toggle("selected"),autocomplete=s.classList[0]}null!=t&&(t.classList.toggle("selected"),null!=t.previousElementSibling&&(t.previousElementSibling.classList.toggle("selected"),autocomplete=resultDiv.getElementsByClassName("selected")[0].classList[0]))}},input.oninput=function(){loadingIndicator.style.visibility="visible",console.log("loading"),resultDiv.style.visibility="visible";resultDiv.getElementsByClassName("selected")[0];0==input.value.length&&(resultDiv.style.visibility="hidden",loadingIndicator.style.visibility="hidden");var e=new XMLHttpRequest;e.open("POST","/search",!0),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){if(resultDiv.innerText="",resultDiv.style.visibility="hidden",4===e.readyState&&200===e.status){console.log("finished loading"),resultDiv.style.visibility="visible",loadingIndicator.style.visibility="hidden";var t=JSON.parse(e.responseText);if(t.length<1)resultDiv.innerHTML="<li>No results :(</li>";else for(var i=0;i<t.length;i++)node=document.createElement("li"),text=document.createElement("span"),sub=document.createElement("span"),br=document.createElement("br"),icon=document.createElement("i"),icon.classList.add("fa"),icon.classList.add("fa-youtube-play"),sub.textContent=" "+t[i].amount+" videos",sub.classList.add("sub"),text.textContent=" "+t[i].title,text.appendChild(br),text.appendChild(icon),text.appendChild(sub),node.classList.add(t[i].id),node.appendChild(text),""!=t[i].thumb&&(image=document.createElement("img"),image.src=t[i].thumb,node.appendChild(image)),resultDiv.appendChild(node),node.onclick=function(){window.open("/youtube/"+this.classList[0],"_self")}}},clearTimeout(timeout),timeout=setTimeout(function(){if(0!=input.value.length){var t=JSON.stringify({search:input.value});e.send(t)}},500)},document.getElementsByTagName("form")[0].onsubmit=function(e){e.preventDefault(),checkRegex()?window.open("/youtube/"+playlist,"_self"):autocomplete?window.open("/youtube/"+autocomplete,"_self"):document.getElementsByTagName("form")[0].submit()};
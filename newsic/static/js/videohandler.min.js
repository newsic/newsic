var ready=!1,complete=!1,loop=!1,prevOrNext="next",i,debug=!0,autoplayFirstVideo=!0,autoplayPlyr=!0,controlsPlyr=["mute","volume","play-large","play","progress","pip","airplay","fullscreen"],i18nPlyr={play:i18n_videohandler_play,pause:i18n_videohandler_pause,seek:i18n_videohandler_seek,buffered:i18n_videohandler_buffered,volume:i18n_videohandler_volume,mute:i18n_videohandler_togglemute,unmute:i18n_videohandler_togglemute,enterFullscreen:i18n_videohandler_togglefullscreen,exitFullscreen:i18n_videohandler_togglefullscreen},optionsPlyr={autoplay:autoplayPlyr,blankUrl:"/static/blank.mp4",debug:!1,iconUrl:"/static/img/plyr/plyr-3.3.21.svg",keyboard:{global:!1,focused:!1},tooltips:{controls:!0},captions:{active:!1},controls:controlsPlyr,i18n:i18nPlyr},video=new Plyr(".plyr",optionsPlyr),muted=video.muted,playPreviousElements=document.getElementsByClassName("playPrevious"),playNextElements=document.getElementsByClassName("playNext"),playCompleteElements=document.getElementsByClassName("playComplete"),playMixElements=document.getElementsByClassName("playMix"),searchLyricsElements=document.getElementsByClassName("searchLyrics"),elementMessage=document.getElementsByClassName("message")[0],elementPlayPause=document.getElementsByClassName("playPause")[0],snippets=document.getElementById("snippets").getElementsByTagName("a"),debugMessage=function(e,t){debug&&("undefined"==typeof t&&(t=!1),t?console.warn(e):console.log(e))},toggleMessage=function(){elementMessage.style.visibility="hidden",elementMessage.style.opacity="0"},showMessage=function(e,t){"undefined"==typeof t&&(t=10),elementMessage.innerHTML='<i class="fas fa-exclamation-triangle"></i> '+e,elementMessage.style.visibility="visible",elementMessage.style.opacity="1",t>0&&setInterval(toggleMessage,1e3*t)},playPause=function(){if(video.togglePlay(),newElement=document.createElement("i"),video.paused){for(;elementPlayPause.firstChild;)elementPlayPause.removeChild(elementPlayPause.firstChild);newElement.classList="fas fa-play",elementPlayPause.appendChild(newElement)}else{for(;elementPlayPause.firstChild;)elementPlayPause.removeChild(elementPlayPause.firstChild);newElement.classList="fas fa-pause",elementPlayPause.appendChild(newElement)}},playComplete=function(){video.pause(),video.currentTime=0,complete=!0,video.play()},playPrevious=function(){i>0&&(prevOrNext="prev",i--,jumpTo(i),updateElements())},playNext=function(){i<snippets.length-1&&(prevOrNext="next",i++,jumpTo(i),updateElements())},playMix=function(){window.open(document.getElementsByClassName("playMix")[1].href,"_self")},searchLyrics=function(){window.open(document.getElementsByClassName("searchLyrics")[1].href,"blank")},updateElements=function(){var e,t=document.getElementsByClassName("countdown");t.length>1&&t[1].classList.toggle("countdown");var s=snippets[i].getElementsByClassName("name")[0].innerText,a=document.createElement("div");a.classList.add("countdown"),snippets[i].insertBefore(a,snippets[i].getElementsByTagName("p")[0]),document.getElementById("title").innerHTML=s,document.getElementsByTagName("title")[0].innerHTML=s+" - "+document.getElementById("snippets").dataset.playlisttitle+" - newsic",e=0,document.getElementsByClassName("searchLyrics")[e].href="https://genius.com/search?q="+s.replace(/\s+/g,"+"),document.getElementsByClassName("playMix")[e].href="/"+snippets[i].dataset.type+"/mix/"+snippets[i].dataset.id+"/",i==snippets.length-1?(playNextElements[0].classList.add("inactive"),playNextElements[0].setAttribute("disabled","disabled")):(playNextElements[0].classList.remove("inactive"),playNextElements[0].removeAttribute("disabled")),0==i?(playPreviousElements[0].classList.add("inactive"),playPreviousElements[0].setAttribute("disabled","disabled")):(playPreviousElements[0].classList.remove("inactive"),playPreviousElements[0].removeAttribute("disabled"))},jumpTo=function(e){video.source={type:"video",sources:[{src:snippets[e].dataset.id,provider:snippets[e].dataset.type}]}},mindTheHash=function(){if(location.hash){debugMessage("Hash is set");var e=window.location.hash.replace("#","");i=e<snippets.length?e:window.location.hash=snippets.length-1}else i=0;debugMessage("This is the beginning of a newsic session, the player is ready. Whoop whoop, fasten your seatbelts, etc."),jumpTo(i),updateElements()},PlyrCustomButton=function(e,t,s,a,l){var n=document.getElementsByClassName("plyr__controls")[0].querySelector(t),i=document.createElement("button");i.classList="plyr__control "+e,i.setAttribute("data-plyr",s),i.setAttribute("type","button"),i.setAttribute("aria-label",r);var o=document.createElement("span");o.classList=a;var r=document.createElement("span");r.classList="label plyr__tooltip",r.setAttribute("role","tooltip"),r.textContent=l,i.appendChild(o),i.appendChild(r),n.parentNode.insertBefore(i,n)};video.on("ready",function(){video.pause(),complete=!1,PlyrCustomButton("playPrevious","[data-plyr=play]","backward","fas fa-backward",i18n_videohandler_previoussnippet),PlyrCustomButton("playNext","div.plyr__progress","backward","fas fa-forward",i18n_videohandler_nextsnippet),PlyrCustomButton("playComplete","[data-plyr=fullscreen]","complete","fas fa-plus-square",i18n_videohandler_completesnippet),PlyrCustomButton("playMix","[data-plyr=fullscreen]","mix","fas fa-random",i18n_videohandler_mix),PlyrCustomButton("searchLyrics","[data-plyr=fullscreen]","lyrics","fas fa-file-alt",i18n_videohandler_lyrics);for(var e=0;e<2;e++)playPreviousElements[e].onclick=playPrevious,playNextElements[e].onclick=playNext,playCompleteElements[e].onclick=playComplete,playMixElements[e].onclick=playMix,searchLyricsElements[e].onclick=searchLyrics;playPauseElements=document.getElementsByClassName("playPause");for(var e=0;e<1;e++)playPauseElements[e].onclick=playPause;"vimeo"===snippets[i].dataset.type&&(ready=!0),"youtube"===snippets[i].dataset.type&&(video.currentTime=parseFloat(snippets[i].getAttribute("data-start"))),debugMessage("Jumped to start time."),debugMessage(snippets[i].dataset.id+" "+snippets[i].dataset.start+" "+snippets[i].dataset.end),autoplayFirstVideo||location.hash||0!==i||"prev"==prevOrNext?video.play():video.pause(),muted||(video.muted=!1)}),video.on("playing",function(){for(;elementPlayPause.firstChild;)elementPlayPause.removeChild(elementPlayPause.firstChild);newElement=document.createElement("i"),newElement.classList="fas fa-pause",elementPlayPause.appendChild(newElement),"vimeo"===snippets[i].dataset.type&&ready&&(console.log("playing event"),video.currentTime=parseFloat(snippets[i].getAttribute("data-start")),debugMessage("Jumped to start time."),debugMessage(snippets[i].dataset.id+" "+snippets[i].dataset.start+" "+snippets[i].dataset.end),ready=!1)}),video.on("pause",function(){for(;elementPlayPause.firstChild;)elementPlayPause.removeChild(elementPlayPause.firstChild);newElement=document.createElement("i"),newElement.classList="fas fa-play",elementPlayPause.appendChild(newElement)}),video.on("error",function(e){var t=snippets[i].getElementsByClassName("name")[0].innerText;"youtube"==snippets[i].dataset.type&&(debugMessage("Error: "+e.detail.code),showMessage(150==e.detail.code||101==e.detail.code?t+": "+i18n_videohandler_embeddingforbidden:t+": "+i18n_videohandler_blocked),"prev"==prevOrNext?playPrevious():playNext())}),video.on("timeupdate",function(){if(i<snippets.length){var e=parseFloat(snippets[i].dataset.end),t=parseFloat(snippets[i].dataset.start);complete&&(e=parseFloat(snippets[i].dataset.length),t=0);var s=document.getElementsByClassName("countdown"),a=video.currentTime,l=Math.floor(e-a)/(e-t)*100+"%";s[0].style.width=s[1].style.width=l,Math.ceil(a)>=e&&(loop?video.currentTime=t:i==snippets.length-1?(video.pause(),debugMessage("This party is over, now get out of here. Seriously.")):(debugMessage("End of snippet, let's go to the next one."),playNext()))}}),mindTheHash(),window.onhashchange=mindTheHash,document.addEventListener("keydown",function(e){if("input"!==e.target.nodeName.toLowerCase()&&!e.ctrlKey&&!e.altKey&&!e.shiftKey)switch(e.key){case"f":video.fullscreen.toggle();break;case"l":searchLyrics();break;case"m":video.muted=!video.muted,muted=!muted;break;case"y":loop=!loop;break;case"x":playMix();break;case"k":case"s":case" ":e.preventDefault(),playPause();break;case"c":playComplete();break;case"a":case"ArrowLeft":playPrevious();break;case"d":case"ArrowRight":playNext()}},!1);